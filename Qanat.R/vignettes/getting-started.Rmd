---
title: "Getting started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  error = TRUE
)
```

## Requirements

The `Qanat.R` package requires R version 4.1 or newer. The package is only available on GitHub, but can be installed with the [`remotes` package](https://remotes.r-lib.org/). The [`sf` package](https://r-spatial.github.io/sf/) is suggested if you are working with the spatial data provided by the API. `remotes` and `sf` can be installed with this line.

```{r eval=FALSE}
if (!require("remotes", "sf")) install.packages("remotes", "sf")
```

## Installation

The next line installs the `Qanat.R` package. 

```{r eval=FALSE}
remotes::install_github("thinkelman-ESA/qanat-community@r-package", subdir = "Qanat.R")
```

## Authentication

If you haven't already, create an API key via the [Groundwater Accounting Platform](https://www.groundwateraccounting.org/getting-started-with-the-api). After loading the package with `libarary(Qanat.R)`, run `set_user_key()` to open a dialog box where you can paste the key that you copied from the Groundwater Accounting Platform. After setting your key, you can confirm that it worked by running `get_user_key()`. 

To avoid setting the key every time, add `X-QANAT-KEY=put_your_unique_key_here` to the .Renviron file. If you are new to editing the .Renviron file, see [`usethis::edit_r_environ()`](https://usethis.r-lib.org/reference/edit.html). 

## Demo geography

A demo geography is provided that allows anyone to explore functionality and features. To request access to the demo geography, please contact info@groundwateraccounting.org. All examples provided by the `Qanat.R` package use the Demo geography.

## Wrapping the API

The `Qanat.R` package wraps the API endpoints into R functions to simplify working with the API. All of the functions perform `GET` requests that return either JSON or GeoJSON objects. By default, all functions return data frames (spatial data frames in the case of GeoJSON objects). Setting `simplify = FALSE` returns a list representation of the JSON object rather than a data frame. Setting `sf = FALSE` returns a list representation of the GeoJSON object; a simplified version of the list is returned when `sf = FALSE` and `simplify = TRUE`.

```{r}
library(Qanat.R)

geographies(simplify = TRUE)

geographies(simplify = FALSE)
```

## HTTP Errors

The package is a thin wrapper around the API endpoints and returns [HTTP error codes](https://en.wikipedia.org/wiki/List_of_HTTP_status_codes) rather than trying to catch potentially malformed requests. One common error involves an incorrect user key.

```{r}
geographies(user_key = "not-a-valid-key")
```

Another example involves resources that are not found. For example, the demo geography only includes one geography ID (5). Any integer other than 5 will not be found.

```{r}
parcels(geography_id = 100)
```

Because the parcels endpoint expects an integer for geography ID, you will get a bad request code if you provide anything other than an integer. Note, though, that you will get a valid result if you pass the geography ID as a string representation of the integer.

```{r}
parcels(geography_id = "not-a-geo-id")
head(parcels(geography_id = "5"))
```

