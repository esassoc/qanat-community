@if (currentUser$ | async; as currentUser) {
    @if (currentGeography$ | async) {
        <water-dashboard-nav [geography]="currentGeography"></water-dashboard-nav>
        @if (currentUser$ | async) {
            <div class="full-width-page">
                <page-header pageTitle="Users" icon="Users" [templateTitleAppend]="templateTitleAppend" [customRichTextTypeID]="richTextID" preTitle="Water Dashboard">
                    <ng-template #templateTitleAppend>
                        <name-tag name="Admin" color="#000" class="mb-2 name-tag-nudge"></name-tag>
                    </ng-template>
                </page-header>
                @if (currentUserGeographies$ | async; as currentUserGeographies) {
                    <div class="page-body" [loadingSpinner]="{ isLoading: isLoading && firstLoad, loadingHeight: 700 }">
                        <app-alert-display></app-alert-display>
                        @if (currentUserGeographies.length > 0) {
                            @if (gridRef) {
                                <qanat-grid-header [grid]="gridRef" [leftAlignClearFiltersButton]="true">
                                    <div customGridActionsRight>
                                        @if (currentUserGeographies.length > 1) {
                                            <div class="form-field" class="geography-selector">
                                                <div class="field">
                                                    <ng-select
                                                        name="Geography"
                                                        [(ngModel)]="currentGeography"
                                                        (ngModelChange)="onGeographySelected(currentUser, $event)"
                                                        [compareWith]="compareGeography"
                                                        [items]="currentUserGeographies"
                                                        [clearable]="false"
                                                        [searchable]="false"
                                                        bindLabel="GeographyName"
                                                        class="custom small">
                                                    </ng-select>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </qanat-grid-header>
                            }
                            <div class="grid-12 mt-3">
                                @if (geographyUsers$ | async; as geographyUsers) {
                                    <div class="tab-nav-panel g-col-12">
                                        <qanat-grid
                                            height="675px"
                                            [rowData]="geographyUsers"
                                            [columnDefs]="columnDefs$ | async"
                                            [overrideDefaultGridHeader]="true"
                                            (gridReady)="gridReady($event)"
                                            (gridRefReady)="gridRef = $event"
                                            downloadFileName="{{ currentGeography.GeographyName.toLowerCase() }}-users"></qanat-grid>
                                    </div>
                                }
                            </div>
                        } @else {
                            <div class="alert alert-info">
                                <div class="alert-content">
                                    <i class="fa fa-info"></i>
                                    Your user profile does not currently have access to view users for this geography.
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
        }
    }
}
