@if (geography$ | async; as geography) {
    <div class="full-width-page">
        <page-header pageTitle="Update Parcels" [templateRight]="templateRight" [templateAbove]="templateAbove" [customRichTextTypeID]="customRichTextTypeID">
            <ng-template #templateRight>
                <button class="btn btn-primary btn-sm" routerLink="/parcels/{{ geography.GeographyName.toLowerCase() }}/upload-parcel-data" [disabled]="unreviewedParcelsCount > 0">
                    Upload Parcel Data
                </button>
            </ng-template>
            <ng-template #templateAbove>
                <div class="back">
                    <a routerLink="/water-dashboard/parcels" class="back__link">Back to All Parcels</a>
                </div>
            </ng-template>
        </page-header>
        <app-alert-display></app-alert-display>
        <div class="page-body grid-12">
            <div class="section-header flex-start">
                <h2 class="section-title text-primary">Review Parcel Changes</h2>
                @if (unreviewedParcelsCount !== null) {
                    <div class="review-stats">
                        <div class="orange">{{ unreviewedParcelsCount | number }} Unreviewed</div>
                        <div>{{ reviewedParcelsCount | number }} Reviewed</div>
                    </div>
                }
            </div>
            @if (latestGDBUpload$ | async; as latestGDBUpload) {
                <note noteType="info">
                    <icon icon="Info"></icon>
                    Parcel data was last uploaded on
                    <b>{{ latestGDBUpload.UploadDate | date: "medium" }}</b>
                </note>
            }
            @if (parcelsToDisplay?.length > 0) {
                <parcel-review-changes-card
                    [parcel]="selectedParcel"
                    [nextButtonDisabled]="parcelsToDisplay?.length === 1"
                    (parcelReviewed)="onParcelReviewed()"
                    (parcelUpdated)="onParcelUpdated()"
                    (nextParcel)="selectNextParcel()"></parcel-review-changes-card>
            } @else {
                @if (parcelsToDisplay?.length === 0) {
                    <div class="no-parcels-to-display">No{{ showReviewedParcels ? " " : " unreviewed " }}parcels to display</div>
                }
            }
            @if (parcels$ | async) {
                <div class="table-responsive">
                    <qanat-grid
                        height="400px"
                        [rowData]="parcelsToDisplay"
                        [columnDefs]="columnDefs"
                        [getRowId]="getRowId"
                        defaultRowSelection="singleRow"
                        [sizeColumnsToFitGrid]="true"
                        (gridReady)="onGridReady($event)"
                        (filterChanged)="onFilterChanged($event)"
                        (selectionChanged)="onParcelSelected($event)">
                        <div customGridActionsLeft>
                            <div class="reviewed-items-toggle">
                                <em class="mr=2">Show Reviewed Items</em>
                                <label class="switch">
                                    <input type="checkbox" name="hideReviewedItems" [(ngModel)]="showReviewedParcels" (ngModelChange)="setParcelsToDisplay()" />
                                    <span class="toggle toggle-primary"></span>
                                </label>
                            </div>
                        </div>
                        <button customGridActionsRight class="btn btn-primary btn-sm" (click)="markAllAsReviewed()">
                            Mark {{ anyGridFilterPresent ? "Filtered" : "All" }} as Reviewed
                            {{ anyGridFilterPresent ? "(" + filteredRowsCount + ")" : "" }}
                        </button>
                    </qanat-grid>
                </div>
            }
        </div>
    </div>
}
