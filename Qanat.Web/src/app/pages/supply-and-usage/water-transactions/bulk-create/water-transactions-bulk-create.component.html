<page-header icon="Transactions" [customRichTextTypeID]="richTextTypeID" [templateAbove]="templateAbove" pageTitle="New Bulk Water Transaction">
    <ng-template #templateAbove>
        <div class="back">
            <a routerLink="../" class="back__link">Back to Water Transactions</a>
        </div>
    </ng-template>
</page-header>

@if (geography$ | async; as geography) {
    <div class="page-body">
        <app-alert-display></app-alert-display>
        <div class="form grid-9 mb-4">
            <div class="field g-col-half">
                <reporting-period-select [geographyID]="geography.GeographyID" (selectionChanged)="onSelectedReportingPeriodChange($event)"></reporting-period-select>
            </div>
        </div>
        <div>
            @if (selectedYear$ | async) {
                <qanat-grid
                    height="500px"
                    [rowData]="parcelSupply$ | async"
                    [columnDefs]="columnDefs$ | async"
                    defaultRowSelection="multiRow"
                    (selectionChanged)="onSelectionChanged($event)"
                    [pagination]="true"
                    [paginationPageSize]="100"
                    [hideDownloadButton]="true"
                    class="clear-action-widths"></qanat-grid>
            }
        </div>
        @if (model) {
            <form class="form pt-4 mb-3 grid-9">
                <div class="field">
                    <label class="d-block required field-label">Supply Type</label>
                    <ng-select
                        class="form-control custom"
                        name="waterType"
                        [(ngModel)]="model.WaterTypeID"
                        [items]="waterTypes$ | async"
                        bindLabel="WaterTypeName"
                        bindValue="WaterTypeID"></ng-select>
                    <field-definition fieldDefinitionType="SupplyType"></field-definition>
                </div>
                <div class="field g-col-half">
                    <label class="required field-label">Quantity (ac-ft/ac)</label>
                    <input type="number" step="1" class="form-control" name="transactionAmount" required [(ngModel)]="model.TransactionAmount" />
                </div>
                <div class="field g-col-half">
                    <label class="required field-label">Effective Date</label>
                    <input type="date" class="form-control" name="effectiveDate" required [(ngModel)]="model.EffectiveDate" />
                    <field-definition fieldDefinitionType="EffectiveDate"></field-definition>
                </div>
                <div class="field">
                    <label class="field-label">Comment</label>
                    <textarea class="form-control" name="userComment" required [(ngModel)]="model.UserComment"></textarea>
                </div>
            </form>
        }
    </div>
}

@if (geography$ | async; as geography) {
    <div class="page-footer">
        <fresca-button class="ml-auto" (click)="onSubmit(geography)" [disabled]="isLoadingSubmit || noParcelsSelected">
            @if (isLoadingSubmit) {
                <span class="fa fa-spinner loading-spinner"></span>
            }
            Save
        </fresca-button>
    </div>
}
