@if (currentGeography$ | async) {
    @if (statementBatchData$ | async) {
        <page-header pageTitle="{{ statementBatch.StatementBatchName }}" icon="Statement" [templateAbove]="templateAbove"> </page-header>
        <ng-template #templateAbove>
            <div class="back">
                <a routerLink=".." class="back__link">Back to All Statements</a>
            </div>
        </ng-template>

        @if (!statementBatch.StatementsGenerated) {
            <div class="alert alert-info">
                <div class="alert-content">
                    <i class="fa fa-info"></i>
                    <span>
                        Statements are currently being generated for this statement batch. <b>{{ statementsGeneratedCount }}</b> of
                        <b>{{ statementBatchWaterAccounts.length }}</b> statements have been generated. Refresh page to view progress, or check back later to view results.
                    </span>
                </div>
            </div>
        }
        <app-alert-display></app-alert-display>

        <div class="page-body grid-12">
            <div class="card" id="details">
                <div class="card-header">
                    <h2>Details</h2>
                </div>
                <div class="card-body grid-8">
                    <div class="g-col-4">
                        <key-value-pair-list>
                            <key-value-pair [horizontal]="true">
                                <ng-container key>Statement Batch</ng-container>
                                <ng-container keyValue>
                                    <div>{{ statementBatch.StatementBatchName }}</div>
                                </ng-container>
                            </key-value-pair>
                            <key-value-pair [horizontal]="true">
                                <ng-container key>Number of Water Accounts</ng-container>
                                <ng-container keyValue>
                                    <div>{{ statementBatch.NumberOfWaterAccounts }}</div>
                                </ng-container>
                            </key-value-pair>
                            <key-value-pair [horizontal]="true">
                                <ng-container key>Reporting Period</ng-container>
                                <ng-container keyValue>
                                    <div>{{ statementBatch.ReportingPeriodYear }}</div>
                                </ng-container>
                            </key-value-pair>
                        </key-value-pair-list>
                    </div>
                    <div class="g-col-4">
                        <key-value-pair-list>
                            <key-value-pair [horizontal]="true">
                                <ng-container key>Template</ng-container>
                                <ng-container keyValue>
                                    <div>{{ statementBatch.StatementTemplateName }}</div>
                                </ng-container>
                            </key-value-pair>
                            <key-value-pair [horizontal]="true">
                                <ng-container key>Last Updated</ng-container>
                                <ng-container keyValue>
                                    <div>{{ statementBatch.LastUpdated | date: "short" }}</div>
                                </ng-container>
                            </key-value-pair>
                            <key-value-pair [horizontal]="true">
                                <ng-container key>Last Updated By</ng-container>
                                <ng-container keyValue>
                                    <div>{{ statementBatch.UpdateUserFullName }}</div>
                                </ng-container>
                            </key-value-pair>
                        </key-value-pair-list>
                    </div>
                </div>
            </div>

            <qanat-grid
                [rowData]="statementBatchWaterAccounts"
                [columnDefs]="columnDefs"
                [sizeColumnsToFitGrid]="true"
                (gridReady)="onGridReady($event)"
                downloadFileName="{{ statementBatch.StatementBatchName }}-water-accounts"
                class="clear-action-widths">
                <div customGridActionsRight class="flex-end">
                    <button (click)="regenerateAllStatements()" class="btn btn-sm btn-primary-outline" [disabled]="isGenerating || isDownloading" [buttonLoading]="isGenerating">
                        Regenerate All Statements
                    </button>
                    <button (click)="bulkDownloadStatements()" class="btn btn-sm btn-primary" [disabled]="isGenerating || isDownloading" [buttonLoading]="isDownloading">
                        Bulk Download PDFs
                    </button>
                </div>
            </qanat-grid>
        </div>
    }
}
